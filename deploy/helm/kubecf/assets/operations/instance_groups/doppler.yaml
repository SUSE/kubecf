# Change the log_cache_ca CN to avoid clashing with the other log-cache certificate CNs.
- type: replace
  path: /variables/name=log_cache_ca/options/common_name
  value: log-cache-ca

# Add quarks properties for doppler.
- type: replace
  path: /instance_groups/name=doppler/jobs/name=doppler/properties/quarks?
  value:
    ports:
    - name: dropsonde-tcp
      protocol: TCP
      internal: 3458
    - name: doppler-tls
      protocol: TCP
      internal: 3459
    - name: doppler-ws
      protocol: TCP
      internal: 8081
    - name: doppler-grpc
      protocol: TCP
      internal: 8082
    - name: log-cache-proxy # log-cache-cf-auth-proxy
      protocol: TCP
      internal: 8083
    run:
      healthcheck:
        doppler:
          readiness:
            exec:
              command: [curl, --fail, --head, --silent, http://localhost:14825/health]

- type: replace
  path: /instance_groups/name=doppler/jobs/name=route_registrar/properties/quarks?/run/healthcheck/route_registrar
  value:
    readiness: ~
      # The route registrar doesn't expose anything to indicate if the
      # routes are healthy
